<!DOCTYPE html>

<html lang="es">

<head>
    <title>Historial</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.11.2/css/all.css">
    <link rel="stylesheet" href=".././css/styles.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>
</head>

<body>
    <!-- Header -->
    <header>
        <div class="jumbotron head_foot">
            <img src=".././images/ecuador.png" class="float-right imagen_header" alt="Escudo de Armas del Ecuador">
            <h1><b>@prendEC</b></h1>
        </div>
    </header>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-md navbar-dark bg-dark sticky-top">
        <div class="container">
            <a class="navbar-brand mx-auto mr-md-3 " href="../public_mod/informativo.html">AprendEC</a>

            <button class="navbar-toggler mx-auto mb-2" data-toggle="collapse" data-target="#colapsado"
                aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="colapsado">
                <ul class="navbar-nav mx-xs-auto ml-md-3">
                    <li class="nav-item">
                        <form class="form-inline">
                            <input class="form-control mr-sm-2 " id="barraBuscar" type="search" placeholder="Buscar"
                                name="busqueda">
                            <button class=" btn btn-outline-primary mx-auto my-2 my-sm-0" type="submit"><i
                                    class="fas fa-search"></i></button>
                        </form>
                    </li>
                </ul>
                <ul class="navbar-nav ml-md-auto mx-xs-auto" id="hey">
                    <li class="nav-item  mx-auto">
                        <a class="nav-link" href="#"><i class="fas fa-bell"></i></a>
                    </li>
                    <!-- Dropdown -->
                    <li class="nav-item dropdown mx-auto">
                        <a class="nav-link dropdown-toggle" href="#" id="navbardrop" data-toggle="dropdown">
                            <i class="far fa-user"></i>
                            <span>Nombre de Usuario</span>
                        </a>
                        <div class="dropdown-menu dropdown-menu-right">
                            <a class="dropdown-item" href="../public_mod/modPublicaciones.html">Publicaciones</a>
                            <a class="dropdown-item" href="../participacion/">Participación</a>
                            <a class="dropdown-item" href="../manejoCuenta/cuenta.html  ">Cuenta</a>
                            <a class="dropdown-item" href="../compras/">Compras</a>
                            <a class="dropdown-item" href="../tienda/">Tienda</a>
                            <a class="dropdown-item" href="../tienda/gestionVentas.html">Gestión de Ventas</a>
                            <a class="dropdown-item" href="../registro/login.html">Cerrar Sesión</a>
                        </div>
                    </li>
                </ul>

            </div>
        </div>
    </nav>
    <!-- Cuerpo -->
    <div class="container-fluid pt-4 pb-4">
        <div class="row">
            <!-- Barra Lateral -->
            <aside class="col-sm-4 pt-4 pb-4 bg-light navbar-light rounded">
                <ul class="nav nav-pills flex-column" role="tablist">
                    <li class="nav-item"><a class="nav-link" href="/compras"><i
                                class="fas fa-shopping-cart"></i>&nbsp;&nbsp;Carrito</a></li>
                    <li class="nav-item"><a class="nav-link active" href="/compras/historial"><i
                                class="far fa-file-alt"></i>&nbsp;&nbsp;Historial de Compras</a></li>
                    <li class="nav-item"><a class="nav-link" href="/compras/direcciones"><i
                                class="fas fa-map-marked-alt"></i>&nbsp;&nbsp;Direcciones</a></li>
                    <li class="nav-item"><a class="nav-link" href="/compras/metodos_pago"><i
                                class="far fa-credit-card"></i>&nbsp;&nbsp;Métodos de Pago</a></li>
                </ul>
            </aside>
            <!-- Secciones de Pestañas -->
            <div class="col-sm-8 pt-4 pb-4">
                <!-- Sección de Carrito -->
                <section class="container" id="historial">
                    <div class="ml-1">
                        <h2>Historial de Compras</h2>
                        <br>
                        <% if (results.length === 0) { %>
                        <!-- Instancia de Historial Vacío -->
                        <div class="vacio">
                            <br>
                            <p><i class="fas fa-ban icono_vacio"></i></p>
                            <h5>Aún no ha realizado ninguna compra.</h5>
                            <hr>
                        </div>
                        <!-- Fin Instancia de de Historial Vacío -->
                        <% } else { %>
                        <% let ultimo_id = -1 %>
                        <table class="table table-striped table-responsive-xl tabla">
                            <thead>
                                <tr>
                                    <th>Fecha</th>
                                    <th>Dirección</th>
                                    <th>Pago</th>
                                    <th>Total (IVA)</th>
                                    <th>Artículos</th>
                                </tr>
                            </thead>
                            <tbody>
                                <% for (let i=0; i < results.length; i++) { %>
                                <% if (ultimo_id !== results[i].id) { %>
                                <% if (i !== 0) { %>
                                    </td>
                                </tr>
                                <% } %>
                                <tr>
                                    <td><%= results[i].fecha_hora_pago %></td>
                                    <td><%= results[i].direccion_envio %></td>
                                    <td><%= results[i].metodo_pago %></td>
                                    <td>$<%= results[i].costo %> USD</td>
                                    <td><%= results[i].nombre %> (<%= results[i].institucion %>)<br>[<%= results[i].cantidad %>] x $<%= results[i].precio %> USD = $<%= bigDecimal.multiply(results[i].precio, results[i].cantidad) %> USD
                                    <% ultimo_id = results[i].id %>
                                <% } else { %>
                                    <br><%= results[i].nombre %> (<%= results[i].institucion %>)<br>[<%= results[i].cantidad %>] x $<%= results[i].precio %> USD = $<%= bigDecimal.multiply(results[i].precio, results[i].cantidad) %> USD
                                <% } %>
                                <% if (i === results.length - 1) { %>
                                    </td>
                                </tr>
                                <% } %>
                                <% } %>
                            </tbody>
                        </table>
                        <!-- Fin Instancia de de Historial -->
                        <% } %>
                    </div>
                </section>
            </div>
        </div>
    </div>
    <!-- Footer -->
    <div class="content"></div>
    <footer>
        <div class="jumbotron text-center head_foot">
            <p>Aprendizaje Online para todo el Ecuador</p>
            AprendEC 2020 <i class="far fa-copyright"></i>
        </div>
    </footer>
</body>

</html>