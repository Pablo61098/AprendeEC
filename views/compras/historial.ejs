<!DOCTYPE html>

<html lang="es">

<head>
    <title>Historial</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.11.2/css/all.css">
    <link rel="stylesheet" href=".././css/styles.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>
    <link href="https://cdn.jsdelivr.net/gh/gitbrent/bootstrap4-toggle@3.6.1/css/bootstrap4-toggle.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/gh/gitbrent/bootstrap4-toggle@3.6.1/js/bootstrap4-toggle.min.js"></script>
    <script type="text/javascript" src=".././javascript/publicaciones/navBarAll.js"></script>
</head>

<body>
    <!-- Header -->
    <header>
        <div class="jumbotron head_foot">
            <img src=".././images/ecuador.png" class="float-right imagen_header" alt="Escudo de Armas del Ecuador">
            <h1><b>@prendEC</b></h1>
        </div>
    </header>
    <!-- Navbar -->
    <%- include('../publicaciones_views/hnf/navbar.ejs') %>
    <!-- Cuerpo -->
    <div class="container-fluid pt-4 pb-4">
        <div class="row">
            <!-- Barra Lateral -->
            <aside class="col-sm-4 pt-4 pb-4 bg-light navbar-light rounded">
                <ul class="nav nav-pills flex-column" role="tablist">
                    <li class="nav-item"><a class="nav-link" href="/compras"><i
                                class="fas fa-shopping-cart"></i>&nbsp;&nbsp;Carrito</a></li>
                    <li class="nav-item"><a class="nav-link active" href="/compras/historial"><i
                                class="far fa-file-alt"></i>&nbsp;&nbsp;Historial de Compras</a></li>
                    <li class="nav-item"><a class="nav-link" href="/compras/direcciones"><i
                                class="fas fa-map-marked-alt"></i>&nbsp;&nbsp;Direcciones</a></li>
                    <li class="nav-item"><a class="nav-link" href="/compras/metodos_pago"><i
                                class="far fa-credit-card"></i>&nbsp;&nbsp;Métodos de Pago</a></li>
                </ul>
            </aside>
            <!-- Secciones de Pestañas -->
            <div class="col-sm-8 pt-4 pb-4">
                <!-- Sección de Carrito -->
                <section class="container" id="historial">
                    <div class="ml-1">
                        <h2>Historial de Compras</h2>
                        <br>
                        <% if (results.length === 0) { %>
                        <!-- Instancia de Historial Vacío -->
                        <div class="vacio">
                            <br>
                            <p><i class="fas fa-ban icono_vacio"></i></p>
                            <h5>Aún no ha realizado ninguna compra.</h5>
                            <hr>
                        </div>
                        <!-- Fin Instancia de de Historial Vacío -->
                        <% } else { %>
                        <% let ultimo_id = -1 %>
                        <table class="table table-striped table-responsive-xl tabla">
                            <thead>
                                <tr>
                                    <th>Fecha</th>
                                    <th>Dirección</th>
                                    <th>Pago</th>
                                    <th>Total (IVA)</th>
                                    <th>Artículos</th>
                                </tr>
                            </thead>
                            <tbody>
                                <% for (let i=0; i < results.length; i++) { %>
                                <% if (ultimo_id !== results[i].id) { %>
                                <% if (i !== 0) { %>
                                </td>
                                </tr>
                                <% } %>
                                <tr>
                                    <td><%= results[i].fecha_hora_pago %></td>
                                    <td><%= results[i].direccion_envio %></td>
                                    <td><%= results[i].metodo_pago %></td>
                                    <td>$<%= results[i].costo %> USD</td>
                                    <td><%= results[i].nombre %>
                                        (<%= results[i].institucion %>)<br>[<%= results[i].cantidad %>] x
                                        $<%= results[i].precio %> USD =
                                        $<%= bigDecimal.multiply(results[i].precio, results[i].cantidad) %> USD
                                        <% ultimo_id = results[i].id %>
                                        <% } else { %>
                                        <br><%= results[i].nombre %>
                                        (<%= results[i].institucion %>)<br>[<%= results[i].cantidad %>] x
                                        $<%= results[i].precio %> USD =
                                        $<%= bigDecimal.multiply(results[i].precio, results[i].cantidad) %> USD
                                        <% } %>
                                        <% if (i === results.length - 1) { %>
                                    </td>
                                </tr>
                                <% } %>
                                <% } %>
                            </tbody>
                        </table>
                        <!-- Fin Instancia de de Historial -->
                        <% } %>
                    </div>
                </section>
            </div>
        </div>
    </div>
    <!-- Footer -->
    <div class="content"></div>
    <footer>
        <div class="jumbotron text-center head_foot">
            <p>Aprendizaje Online para todo el Ecuador</p>
            AprendEC 2020 <i class="far fa-copyright"></i>
        </div>
    </footer>
</body>

</html>